## 发布分类

1. 引入 antd-design 表单，完成页面渲染

## 分类管理

1. 点击编辑按钮，跳转到编辑分类页面

   > 全局定义一个 routeObj 对象，didmount 函数中提升 props 的存储位置

   ```
   let routeObj = null;
   routeObj = this.props;
   ```

> 通过 this.props.history.push 方法来实现跳转

    ```
    routeObj.history.push({
                        pathname: '/product/editcategory',
                        state:record
                    })
    ```

2.  form 表单显示当前分类数据

    ```
    this.props.form.setFieldsValue({  //设置表单初始值
        'cfyname': this.props.location.state.cfyname,
        'cfytype': this.props.location.state.cfytype
        })
    ```

3.  点击确认修改，修改数据库数据

    > 使用 put 方法请求

        ```
        editCate(objectId,values).then((res) => {})
        ```

4.  上传图片
    > 结合 antd-design 的 upload 组件+leancloudSDK 使用

- 封装 upload 组件，方便复用
- 实现功能：如何将图片上传至 leancloud

  - 安装：
    ```
    yarn add leancloud-storage --save
    ```
  - 引入上传文件所需要的 sdk

  ```
  const Cloud = require('leancloud-storage')
  ```

  - 初始化 sdk

  ```
  Cloud.init({
   appId: "MPDqrLOsJwNgIoAdUYlA4ufP-gzGzoHsz",
   appKey: "UOpSw7ILtuBYldhacX0Rllxk",
   serverURL: "https://mpdqrlos.lc-cn-n1-shared.com"
  });
  ```

  - 构建 sdk 文件对象

  ```
  const data = { base64: imageUrl };
  const file = new Cloud.File('cfyimg.png', data);
  ```

  - 执行文件的保存提交操作

  ```
    file.save().then((file) => {
      console.log(`文件保存完成。objectId：${file.id}`);
    }, (error) => {
      // 保存失败，可能是文件无法被读取，或者上传过程中出现问题
    });
  ```

  - 追加 cfyimg 到表单数据 values 中

  ```
  values.cfyimg = this.state.cfyimg
  ```

  - 初始化页面 cfyimg 数据
    > 如果之前没有提交过 cfyimg，则，用 antd 提供的 imageUrl，否则获取 initImg 数据并进行展示
    > 父子通信：父组件内定义属性

  ```
   initimg={this.props.history.location.state.cfyimg}
  ```

  > 子组件，设置 url

  ```
  {imageUrl || this.props.initimg ? <img src=
  {imageUrl || this.props.initimg} alt="avatar" style={{ width: '100%' }} /> : uploadButton}
  ```
