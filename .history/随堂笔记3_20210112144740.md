## redux 方案选型

1. Redux + React-Redux +Redux-thunk【选择此方案】

2. Redux + React-Redux + @rematch/core
   [@rematch/core](https://rematch.gitbook.io/handbook/)

3. Redux + React-Redux + dva
   [dva](https://dvajs.com/)

> @rematch/core 跟 dva 都是为了进一步简化开发者使用 Redux 的语法

## 创建状态机

1. store 文件夹中创建 index.js 文件
   > combinReducers 可以将多个纯函数进行整合后，给 createStore 使用

```
import {createStore,combineReducers} from 'redux'
import reducers from '../reducer'
const store = createStore(combineReducers(reducers))
export default store
```

2. 定义 reducer

- index.js

```
import {user} from './user.js'
export default {user}
```

- user.js

```
import {LOGIN_START,LOGIN_SUCCESS,LOGIN_FAIL} from '../action/actionTypes'
let initState = {username: 'admin',mobile: 18782223333,}
export const user = (state = initState, action) => {
    switch (action.type) {
        default:
            return state
    }
}
```

3. action
   > 描述用户操作行为的对象
   > actionCreator 生成 action 的方法函数

- actionTypes.js
  > 统一管理所有 action 的 type 常量

```
//用户登录相关状态
export const LOGIN_START = 'LOGIN_START'
export const LOGIN_SUCCESS = 'LOGIN_SUCCESS'
export const LOGIN_FAIL = 'LOGIN_FAIL'
```

- index.js
  > 存放所有 actionCreator
  > 用以生成状态机所需 action 的

```
import { LOGIN_START,LOGIN_SUCCESS,LOGIN_FAIL} from './actionTypes'
export const loginStart = () => { //创造开启登录action的方法函数，同步action
    return { type: LOGIN_START }
}
export const loginSuccess = (payload) => { ///触发登录成功的action，同步action
    return { type: LOGIN_SUCCESS,payload }
}
export const loginFail = () => { //创造开启登录失败的方法函数，同步action
    return { type: LOGIN_FAIL }
}
```

## 入口文件 index.js 中用 Provider 包装

```
import store from "./store/index";
import { Provider } from "react-redux";
ReactDOM.render(
  <Provider store={store}>
    <App />
  </Provider>,
  document.getElementById("root")
);
```

## Admin 组件中试用

```
import { connect} from "react-redux";
const mapStateToProps = (state) => {
  return { 'user':state.user}
}
export default connect(mapStateToProps)(Admin);
```

## 登录状态及流程思考

1. 开始登录  
> 对应action中的  loginStart
 + isLoading   效果开启  true
 + isLogin     用户是否登录成功 false
 + userInfo    空对象

2. 登录成功
> 对应action中的  loginSuccess
 + isLoading   效果开启  false
 + isLogin     用户是否登录成功 true
 + userInfo    后端下发（本地提取）用户信息对象

3. 登录失败
> 对应action中的  loginFail
 + isLoading   效果开启  false
 + isLogin     用户是否登录成功 false
 + userInfo    空对象


 ## LeanCloud用户登录

 1. 在_User表中新增一个用户

 2. 在api/userApi.js中新增发起登录的方法

 3. 在action/index.js中加入异步action


## 配置redux-thunk异步模块
 
 1. 不配置redux-thunk的报错信息
 ```
 : Actions must be plain objects. Use custom middleware for async actions.
 ```

 2. 配置redux-thunk的方式
 > store/index.js
 ```
 import {createStore,combineReducers,applyMiddleware} from 'redux'
import reducers from '../reducer'
import thunk from 'redux-thunk'  //【1】引入异步action操作的中间件
const store = createStore(
  combineReducers(reducers),
  applyMiddleware(thunk) //【2】将异步模块集成到redux中去
)
export default store
 ```

 3. 异步action的定义方式
 ```
export const loginActSync = ()=>{  //用以发起用户登录异步请求的action
  return (dispatch)=>{  // 将action自动dispatch的动作拦截到此处
    dispatch(loginStart())  //手动dispatch，开启用户登录
  }
}
 ```

 ## 任务
> 今天的内容是重点也是难点
1. 掌握combinReducer的使用

2. 掌握applayMiddleware 向redux集成redux-thunk的过程

3. 思考独立action模块的作用
  - actionTypes.js
  - index.js         actionCreator

4. 梳理登录目前实现的功能流程【画一个流程图】